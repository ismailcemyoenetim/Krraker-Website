<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CemSite Grid System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://w.soundcloud.com/player/api.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <a href="canvas.html" class="lab-button" style="position: fixed; left: 10px; top: 50%; transform: translateY(-50%); z-index: 1000; padding: 10px; background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(10px); border-radius: 7px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);"><img src="images/Labicon.png" alt="Lab" style="width: 22px; height: auto;"></a>
    <a href="terminal.html" class="terminal-button" id="terminal-button">&lt;/&gt;</a>
    <div class="logo">
        <a href="index.html"><img src="assets/logo.svg" alt="Logo"></a>
    </div>
    
    <!-- Local Time Indicator -->
    <div id="localTimeIndicator">
        <span id="locationName">IST</span>
        <span id="localTime">00:00:00</span>
    </div>
    
    <!-- Color Invert Button -->
    <button class="invert-button">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>
    
    <div id="mediaPlayerContainer">
        <div class="controls">
            <button id="playPauseBtn"><span>&#9658;</span></button>
        </div>
        <div class="track-info">
            <div class="track-name">Yükleniyor...</div>
            <div class="player-wrapper">
                <iframe id="youtubePlayer" width="100%" height="80" src="https://www.youtube.com/embed/videoseries?list=PLPqNPeVcnMzP-F5HUBMrQiYyjq188fGBi&enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                <div class="player-controls">
                    <button id="prevBtn">⏮</button>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-time" id="progressTime">0:00 / 0:00</div>
                    </div>
                    <button id="nextBtn">⏭</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Playlist Dropdown -->
    <div id="playlistDropdown" class="playlist-dropdown">
        <button id="playlistToggleBtn" class="playlist-toggle-btn">▼</button>
        <ul id="playlistItems" class="playlist-items"></ul>
    </div>
    
    <nav class="main-nav">
        <div class="left-menu-container">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link">MENU</a>
                    <div class="dropdown">
                        <ul>
                            <li><a href="pages/about.html">About</a></li>
                            <li><a href="pages/contact.html">Contact</a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">SHOP</a>
                    <div class="dropdown">
                        <ul>
                            <li><a href="pages/shop/apparel.html">Apparel</a></li>
                            <li><a href="pages/shop/accessories.html">Accessories</a></li>
                            <li><a href="pages/shop/homegoods.html">Home goods</a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="pages/projects.html" class="nav-link">PROJECTS</a>
                    <div class="dropdown">
                        <ul>
                            <li><a href="pages/projects.html">All Projects</a></li>
                            <li><a href="pages/projects/current.html">Current</a></li>
                            <li><a href="pages/projects/past.html">Past</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        
        <div class="logo">
            <a href="index.html">
                <img src="images/KrakerLogo.png" alt="Kraker Logo">
            </a>
        </div>
        
        <div class="right-menu-container">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="pages/login.html" class="nav-link">LOGIN</a>
                    <div class="dropdown">
                        <ul>
                            <li><a href="pages/login/email.html">Email Login</a></li>
                            <li><a href="pages/login/social.html">Social Login</a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="pages/register.html" class="nav-link">REGISTER</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">CART</a>
                    <div class="dropdown">
                        <ul>
                            <li><a href="pages/cart/items.html">Items</a></li>
                            <li><a href="pages/cart/checkout.html">Checkout</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    
    <div id="gridContainer" class="grid-container"></div>
    
    <script src="scripts/grid.js"></script>
    <script src="scripts/direction-hover.js"></script>
    
    <!-- Auth UI script for navigation updates -->
    <script type="module" src="scripts/auth-ui.js"></script>
    
    <script>
        // Media Player Functions - YouTube özel medya oynatıcı kontrolü
        let player;
        let isPlaying = false;
        let videoDuration = 0;
        let currentPlaylistIndex = 0;
        let playlistData = []; // Add this to store playlist info
        let isPlaylistOpen = false; // Add this to track dropdown state
        
        // --- Manual Playlist Titles ---
        const manualPlaylistTitles = [
            "Air — Bossa 96 (Demo)",
            "The Herbaliser — The Sensual Woman",
            "Squarepusher — Beep Street",
            "Air — Jeanne",
            "Squarepusher — Seb-1.09",
            "Birsen Tezer — Di Gel Yanıma",
            "Amon Tobin — Nova",
            "Air — Le voyage de Pénélope",
            "Bülent Ortaçgil — Bu İş Çok Zor Yonca",
            "Birsen Tezer — Değişrmenler", // Note: Typo might be intentional based on original
            "Mount Kimbie — Shipwreck",
            "Air — La femme d'argent",
            "Air — Ce matin-là (Demo 2)",
            "Air — Sexy Boy (Etienne de Crécy & the Flower Pistols Remix)",
            "Boards Of Canada — Davyan Cowboy",
            "Boards Of Canada — Roygbiv",
            "Boards Of Canada — Gyroscope",
            "Boards Of Canada — Olson",
            "Bülent Ortaçgil — Şık Latife",
            "Bülent Ortaçgil — Beni Kategorize Etme",
            "Morcheeba — Blood Like Lemonade",
            "Sibylle Baier — Tonight",
            "Sibylle Baier — I Lost Something in the Hills",
            "Sibylle Baier — Give Me a Smile",
            "Elliott Smith — A Fond Farewell (2024 Remaster)", 
            "Elliott Smith — Son Of Sam",
            "Birsen Tezer — Aşk Bu değil",
            "Squarepusher — Coopers World",
            "Mount Kimbie — Empty And Silent (feat. King Krule)",
            "Mount Kimbie — Fishbrain",
            "Bar Italia — Nurse!"
        ];
        // ---
        
        // YouTube API'sini başlat
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtubePlayer', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        function onPlayerReady(event) {
            console.log('YouTube player ready');
            // Video süresini al
            videoDuration = player.getDuration();
            // Çalma listesi bilgilerini al
            try {
                currentPlaylistIndex = player.getPlaylistIndex();
                const playlistLength = player.getPlaylist().length;
                console.log(`Playlist loaded: ${playlistLength} videos, current index: ${currentPlaylistIndex}`);
                // Hemen şarkı ismini güncellemek için updateCurrentSongInfo çağırıyoruz
                setTimeout(updateCurrentSongInfo, 300);
                // İlerleme çubuğunu başlatmak için updateProgress çağırıyoruz
                updateProgress();
            } catch (e) {
                console.log('Playlist info could not be retrieved:', e);
            }
            // Otomatik çalma başlat
            setTimeout(function() {
                player.playVideo();
            }, 1000);
        }
        
        function onPlayerStateChange(event) {
            // 1 = playing, 2 = paused, 0 = ended, 5 = video cued
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                document.getElementById('playPauseBtn').innerHTML = '<span>&#10074;&#10074;</span>';
                // Şarkı başladığında süre bilgisini güncelle
                videoDuration = player.getDuration() || 0;
                updateProgress();
                // Şarkı adını güncelle
                updateCurrentSongInfo();
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                document.getElementById('playPauseBtn').innerHTML = '<span>&#9658;</span>';
                highlightCurrentTrack(); // Update highlight on pause
            } else if (event.data == YT.PlayerState.ENDED) {
                isPlaying = false;
                document.getElementById('playPauseBtn').innerHTML = '<span>&#9658;</span>';
                highlightCurrentTrack(); // Update highlight on end
            } else if (event.data == YT.PlayerState.CUED) {
                // Şarkı değiştiğinde ismi güncelle (cued durumunda)
                document.querySelector('.track-name').textContent = "Yükleniyor...";
                // Süre bilgisini sıfırla ve güncelle
                videoDuration = 0;
                const progressTime = document.getElementById('progressTime');
                if (progressTime) {
                    progressTime.textContent = "0:00 / 0:00";
                }
                setTimeout(updateCurrentSongInfo, 500);
                highlightCurrentTrack(); // Update highlight when title updates
            } else if (event.data == YT.PlayerState.BUFFERING) {
                // Buffer durumunda da şarkı değişmiş olabilir
                setTimeout(updateCurrentSongInfo, 1000);
            }
        }
        
        // Güncel şarkı bilgisini güncelle - MANUAL titles & MARQUEE
        function updateCurrentSongInfo() {
            try {
                if (!player || typeof player.getPlaylistIndex !== 'function') {
                    console.log('Player not ready for song info.');
                    return;
                }

                const currentIndex = player.getPlaylistIndex();
                const trackNameElement = document.querySelector('.track-name');
                let displayText = manualPlaylistTitles[currentIndex] || `Şarkı ${currentIndex + 1}`; // Default or manual title

                // --- Check if scrolling is needed and set content --- 
                trackNameElement.innerHTML = ''; // Clear previous content
                trackNameElement.classList.remove('scrolling'); // Remove class first

                // Create a temporary span to measure text width
                const tempSpan = document.createElement('span');
                tempSpan.style.visibility = 'hidden'; // Don't show temporarily
                tempSpan.style.position = 'absolute'; // Avoid affecting layout
                tempSpan.textContent = displayText;
                document.body.appendChild(tempSpan); // Add to body to measure
                const textWidth = tempSpan.offsetWidth;
                document.body.removeChild(tempSpan); // Remove temporary span

                const containerWidth = trackNameElement.clientWidth; 

                // Create the actual content span that will hold the text
                const contentSpan = document.createElement('span');

                if (textWidth > containerWidth) {
                    console.log('Marquee needed. Text:', textWidth, 'Container:', containerWidth);
                    // Set duplicated text in the single span
                    // Add more non-breaking spaces for a clearer gap
                    contentSpan.textContent = `${displayText}\u00A0\u00A0\u00A0\u00A0\u00A0${displayText}`;
                    trackNameElement.appendChild(contentSpan);
                    trackNameElement.classList.add('scrolling'); // Add class to parent container
                } else {
                    console.log('No marquee needed. Text:', textWidth, 'Container:', containerWidth);
                    // Just display the text normally in the single span
                    contentSpan.textContent = displayText;
                    trackNameElement.appendChild(contentSpan);
                    // No .scrolling class needed
                }
                // ---

                console.log(`Now playing (Index ${currentIndex}):`, displayText);

                // Update duration info
                const duration = player.getDuration() || 0;
                if (videoDuration !== duration) {
                    videoDuration = duration;
                    console.log('Video duration updated:', videoDuration);
                }
                updateProgress(); // Update progress bar display
                highlightCurrentTrack(); // Highlight in the dropdown

            } catch (e) {
                console.error('Error updating current song info:', e);
            }
        }
        
        // Şarkı ismi sığmayacak kadar uzunsa kaydırma animasyonunu etkinleştir
        // function checkIfTitleNeedsScrolling(element) { // REMOVED - Logic moved into updateCurrentSongInfo
        //     // ... (old logic removed) ...
        // }
        
        document.addEventListener('DOMContentLoaded', function() {
            const playPauseBtn = document.getElementById('playPauseBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            const playlistDropdown = document.getElementById('playlistDropdown');
            const playlistToggleBtn = document.getElementById('playlistToggleBtn');
            const playlistItemsUl = document.getElementById('playlistItems');
            const mediaPlayerContainer = document.getElementById('mediaPlayerContainer'); // Get player container

            // --- Dynamically position the playlist dropdown below the player ---
            function positionPlaylistDropdown() {
                if (mediaPlayerContainer && playlistDropdown) {
                    const playerRect = mediaPlayerContainer.getBoundingClientRect();
                    const playerBottom = playerRect.bottom;
                    // Add a small gap (e.g., 2px) below the player
                    playlistDropdown.style.top = `${playerBottom + 2}px`; 
                    console.log(`Playlist dropdown positioned at top: ${playlistDropdown.style.top}`);
                }
            }
            positionPlaylistDropdown(); // Position initially
            // Reposition on window resize (optional but good practice)
            window.addEventListener('resize', positionPlaylistDropdown);
            // ---

            // Play/Pause butonu
            playPauseBtn.addEventListener('click', function() {
                if (isPlaying) {
                    player.pauseVideo();
                    playPauseBtn.innerHTML = '<span>&#9658;</span>';
                } else {
                    player.playVideo();
                    playPauseBtn.innerHTML = '<span>&#10074;&#10074;</span>';
                }
            });
            
            // Önceki/Sonraki butonlar - YouTube listesi için
            prevBtn.addEventListener('click', function() {
                try {
                    // İlk olarak "Yükleniyor..." olarak ayarla
                    document.querySelector('.track-name').textContent = "Yükleniyor...";
                    player.previousVideo();
                    
                    // Şarkı bilgisini birkaç kez güncellemeyi dene (toplamda 3 saniye)
                    setTimeout(updateCurrentSongInfo, 500);
                    setTimeout(updateCurrentSongInfo, 1500);
                    setTimeout(updateCurrentSongInfo, 3000);
                } catch (e) {
                    console.error('Error playing previous video:', e);
                }
            });
            
            nextBtn.addEventListener('click', function() {
                try {
                    // İlk olarak "Yükleniyor..." olarak ayarla
                    document.querySelector('.track-name').textContent = "Yükleniyor...";
                    player.nextVideo();
                    
                    // Şarkı bilgisini birkaç kez güncellemeyi dene (toplamda 3 saniye)
                    setTimeout(updateCurrentSongInfo, 500);
                    setTimeout(updateCurrentSongInfo, 1500);
                    setTimeout(updateCurrentSongInfo, 3000);
                } catch (e) {
                    console.error('Error playing next video:', e);
                }
            });
            
            // İlerleme çubuğuna tıklama
            progressContainer.addEventListener('click', function(e) {
                if (!player || !videoDuration) return;
                
                const rect = this.getBoundingClientRect();
                const position = (e.clientX - rect.left) / rect.width;
                const seekPosition = Math.floor(position * videoDuration);
                player.seekTo(seekPosition, true);
            });

            // Playlist Toggle Button
            playlistToggleBtn.addEventListener('click', function() {
                isPlaylistOpen = !isPlaylistOpen;
                playlistDropdown.classList.toggle('open');
                playlistToggleBtn.textContent = isPlaylistOpen ? '▲' : '▼'; // Change arrow direction
                if (isPlaylistOpen && playlistData.length === 0) {
                    // Fetch playlist data if not already fetched
                    fetchPlaylistData(); 
                }
            });

            // Function to fetch and populate playlist
            function fetchPlaylistData() {
                if (!player || typeof player.getPlaylist !== 'function') {
                    console.log('Player not ready for playlist fetch.');
                    playlistItemsUl.innerHTML = '<li class="playlist-item">Playlist yüklenemedi.</li>';
                    return;
                }
                try {
                    const playlist = player.getPlaylist(); // Get array of video IDs
                    // const playlistMetadata = player.getPlaylistMetadata(); // REMOVED - Function doesn't exist

                    if (!playlist || playlist.length === 0) {
                        console.log('Playlist could not be retrieved or is empty.');
                        playlistItemsUl.innerHTML = '<li class="playlist-item">Playlist boş.</li>';
                        return;
                    }
                    
                    playlistData = []; // Clear previous data
                    playlistItemsUl.innerHTML = ''; // Clear existing list items
                    console.log(`Found ${playlist.length} videos in playlist.`);

                    // Use manual titles based on playlist index
                    playlist.forEach((videoId, index) => {
                        const title = manualPlaylistTitles[index] || `Şarkı ${index + 1}`; // Use manual title or placeholder
                        playlistData.push({ videoId: videoId, title: title }); 
                        const li = document.createElement('li');
                        li.classList.add('playlist-item');
                        li.textContent = title; 
                        li.dataset.index = index;
                        li.addEventListener('click', function() {
                            try {
                                player.playVideoAt(parseInt(this.dataset.index));
                                // Close dropdown after selection (optional)
                                isPlaylistOpen = false;
                                playlistDropdown.classList.remove('open');
                                playlistToggleBtn.textContent = '▼';
                            } catch (playError) {
                                console.error("Error playing video at index:", playError);
                            }
                        });
                        playlistItemsUl.appendChild(li);
                    });

                    highlightCurrentTrack(); // Highlight after loading placeholders
                    console.log('Playlist data populated with manual titles (or placeholders):', playlistData);

                } catch (e) {
                    console.error('Error processing playlist data:', e);
                    playlistItemsUl.innerHTML = '<li class="playlist-item">Playlist işlenirken hata oluştu.</li>';
                }
            }

            // Function to highlight the currently playing track in the list
            function highlightCurrentTrack() {
                 if (!player || typeof player.getPlaylistIndex !== 'function' || playlistData.length === 0) {
                    return; // Exit if player or data not ready
                 }
                 const currentIndex = player.getPlaylistIndex();
                 const items = playlistItemsUl.querySelectorAll('.playlist-item');
                 items.forEach((item, index) => {
                     if (index === currentIndex) {
                         item.classList.add('active');
                     } else {
                         item.classList.remove('active');
                     }
                 });
             }
            
             // Make highlight function global or accessible
             window.highlightCurrentTrack = highlightCurrentTrack; 
        });
        
        // Renk tersine çevirme fonksiyonu
        document.querySelector('.invert-button').addEventListener('click', function() {
            // First add the transition class
            document.body.classList.add('theme-switching');
            
            // Prevent multiple clicks during animation
            if (this.getAttribute('data-animating') === 'true') return;
            this.setAttribute('data-animating', 'true');
            
            // Toggle inverted class with a small delay to let animation start
            setTimeout(() => {
                document.body.classList.toggle('inverted');
            }, 10);
            
            // Remove animation class after it completes
            setTimeout(() => {
                document.body.classList.remove('theme-switching');
                this.setAttribute('data-animating', 'false');
            }, 500);
        });
        
        // Yerel saat ve konum fonksiyonları
        async function updateLocalTime() {
            try {
                // IP bazlı konum bilgisi al
                const response = await fetch('https://api.ipdata.co?api-key=test', { 
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Konum bilgisini göster
                const locationName = document.getElementById('locationName');
                locationName.textContent = `${data.city || 'Unknown'}, ${data.country_code || '--'}`;
                
                // Saat bilgisini güncelle
                function updateTime() {
                    const now = new Date();
                    let timeString;
                    
                    try {
                        const timeOptions = { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            second: '2-digit',
                            hour12: false,
                            timeZone: data.time_zone?.name || Intl.DateTimeFormat().resolvedOptions().timeZone
                        };
                        timeString = now.toLocaleTimeString('en-US', timeOptions);
                    } catch (e) {
                        timeString = now.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            second: '2-digit',
                            hour12: false
                        });
                    }
                    
                    document.getElementById('localTime').textContent = timeString;
                }
                
                // Her saniye saat bilgisini güncelle
                updateTime();
                setInterval(updateTime, 1000);
                
            } catch (error) {
                console.error('Error fetching location:', error);
                try {
                    // Alternatif API deneyin
                    const response = await fetch('https://geolocation-db.com/json/');
                    const data = await response.json();
                    
                    const locationName = document.getElementById('locationName');
                    locationName.textContent = `${data.city || 'Unknown'}, ${data.country_code || '--'}`;
                    
                    function updateTime() {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            second: '2-digit',
                            hour12: false
                        });
                        document.getElementById('localTime').textContent = timeString;
                    }
                    
                    updateTime();
                    setInterval(updateTime, 1000);
                } catch (backupError) {
                    console.error('Backup location service failed:', backupError);
                    // Yedek hata durumunda yerel saat göster
                    const locationName = document.getElementById('locationName');
                    locationName.textContent = 'Local Time';
                    
                    function updateLocalTimeOnly() {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            second: '2-digit',
                            hour12: false
                        });
                        document.getElementById('localTime').textContent = timeString;
                    }
                    
                    updateLocalTimeOnly();
                    setInterval(updateLocalTimeOnly, 1000);
                }
            }
        }
        
        // Sayfa yüklendiğinde yerel saat bilgisini başlat
        updateLocalTime();

        // updateProgress fonksiyonunu buraya taşıyalım
        function updateProgress() {
            if (!player) return;
            
            try {
                // Player hazır değilse yeniden dene
                if (typeof player.getCurrentTime !== 'function') {
                    console.log('Player henüz hazır değil, updateProgress yeniden denenecek');
                    setTimeout(updateProgress, 500);
                    return;
                }
                
                const currentTime = player.getCurrentTime() || 0;
                const duration = player.getDuration() || 0;
                
                // Süre henüz yüklenmemişse bekleme
                if (duration <= 0 || isNaN(duration)) {
                    console.log('Video süresi alınamadı, yeniden denenecek');
                    setTimeout(updateProgress, 500);
                    return;
                }
                
                // videoDuration global değişkenini güncelle
                if (videoDuration !== duration) {
                    videoDuration = duration;
                    console.log('Video duration güncellendi:', videoDuration);
                }
                
                // İlerleme çubuğunu güncelle
                const progress = (currentTime / duration) * 100;
                const progressBar = document.getElementById('progressBar'); // Tanımı buraya alalım
                if (progressBar) { // Elementin varlığını kontrol et
                    progressBar.style.width = `${progress}%`;
                }
                
                // Süre formatla (MM:SS)
                const formatTime = (time) => {
                    if (isNaN(time) || time < 0) return "0:00";
                    const minutes = Math.floor(time / 60);
                    const seconds = Math.floor(time % 60);
                    return `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
                };
                
                // Süre göstergesini güncelle
                const progressTime = document.getElementById('progressTime');
                if (progressTime) {
                    progressTime.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
                    
                    // Debug için süre bilgisini yazdır
                    // console.log(`Süre: ${formatTime(currentTime)} / ${formatTime(duration)} (${currentTime.toFixed(2)}s / ${duration.toFixed(2)}s)`); // Debug için gerekirse açılabilir
                }
                
                // Top göstergesinin görünürlüğünü kontrol et (Bu kısım DOMContentLoaded içinde kalabilir veya globalde de olabilir, şimdilik burada bırakalım)
                const progressContainer = document.getElementById('progressContainer'); // Tanımı buraya alalım
                if (progressBar && progressContainer) { // Elementlerin varlığını kontrol et
                    if (progress > 0) {
                        progressContainer.classList.add('active-progress');
                    }
                    // Not: ::after pseudo-elementini JS ile doğrudan seçemeyiz, bu kontrol işe yaramayabilir.
                    // const topIndicator = progressBar.querySelector('::after') || progressBar;
                }
                
            } catch (e) {
                console.error("Error updating progress bar:", e);
            }
            
            // Sürekli güncelleme için - çalıyor olup olmadığına bakılmaksızın güncelleme yapılır
            requestAnimationFrame(updateProgress);
        }
    </script>
</body>
</html> 